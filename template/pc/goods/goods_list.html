{include file="public/head"}
<body>
	<h2><a href="/">养殖天网</a></h2>
	{$cur_city} 我已上架的产品列表
	<ul>
		<li>
			<span>地区</span>
			<span>品种</span>
			<span>数量</span>
			<span>价格</span>
			<span>上架时间</span>
			<span>操作</span>
		<li>
			-------下方 | 线只是分割作用，修改样式时删除掉！ 本行也删除-----
			{volist name="list" id="item"}
		<li>
			<input class="foo_del" type="hidden" data-url="{:Url('AjaxCrud/handle')}" data-handle="U" data-table="Goods" data-KN="id" data-KV="{$item.id}" data-FN="on_sell" data-FV="0"  />
			<span>{$item.region_name}</span>|
			<span>{$item.cat_name}</span>|
			<span>{$item.num}</span>|
			<span>{$item.price}元/只</span>|
			<span>{$item.add_time}</span>|
			<button class="foo_trigger">下架</button>
		</li>
		{/volist}
	</ul>
	<button id="add">添加</button>
	<form id="add_form" class="none" method="post" action="{:Url('Goods/add_goods')}">
		<select name="cat_id">
			<option value="0">--请选择分类--</option>
			{volist name="$son_cat" id="cat"}
			<option value="{$cat.id}">{$cat.name}</option>
			{/volist}
			<input placeholder="数量" name="num"/>
			<input placeholder="价格(元)" name="price"/>
		</select>
		<button class="foo_submit">确定</button>
	</form>
	<script>
		$(function () {
			show_form_event();
			del_event();
		});
		// 【显示】动作的事件监听器
		function show_form_event() {
			$(document.body).on('click', "#add", function () {
				$("#add_form").toggle();
			});
		}
		// 【删除】动作的事件监听器
		function del_event() {
			$(document.body).on('click', ".foo_trigger", function () {
				if (confirm("您确定下架吗？")) {
					var binder = $(this).siblings('.foo_del');
					console.log(binder.data());
					var url = binder.data('url');
					$.post(url, binder.data(), function (data) {
						if (data.is_done > 0) {
							console.log('成功');
						}
						binder.parent('li').remove();
					});
				}
			});
		}
	</script>
</body>
{include file="public/foot"}
